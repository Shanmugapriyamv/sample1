C51 COMPILER V9.60.7.0   CODE                                                              01/25/2024 16:45:53 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE CODE
OBJECT MODULE PLACED IN .\Objects\code.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE code.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\code
                    -.lst) TABS(2) OBJECT(.\Objects\code.obj)

line level    source

   1          /*********************************************************************
   2          *Project:MG82F6B08_001_104-DEMO
   3          *     MG82F6B08_001_104 SOP16_V11 EV Board (TH221A)
   4          *     CpuCLK=8MHz, SysCLK=8MHz
   5          *Description:
   6          *     set P44/P45 to GPIO, Disable OCD function
   7          *     set P47 to GPIO, Disable RESET function
   8          *Note:
   9          *     If P44,P45 and P47 are used for GPIO at the same time, OCD-ICE cannot be used for burning and simulati
             -on.
  10          *     To restore OCD function, it is necessary to use U1 burning the other code.
  11          *
  12          *Creat time:
  13          *Modify:
  14          *  
  15          code is modified test 2.2..in edit file
  16          next modification done ..
  17          modified on 25/01..
  18          stage 2 on 25/01
  19          
  20          *********************************************************************/
  21          #define _MAIN_C
  22          
  23          #include <Intrins.h>
  24          #include <Absacc.h>
  25          
  26          #include <Stdio.h>  // for printf
  27          
  28          #include "REG_MG82F6B08_001_104.H"
  29          #include "Type.h"
  30          #include "API_Macro_MG82F6B08_001_104.H"
  31          #include "API_Uart_BRGRL_MG82F6B08_001_104.H"
  32          
  33          
  34          /*************************************************
  35          *Set SysClk (MAX.24MHz)
  36          *Selection: 
  37          * 8000000,16000000
  38          * 11059200,22118400
  39          *************************************************/
  40          #define MCU_SYSCLK    8000000
  41          /*************************************************/
  42          /*************************************************
  43          *Set CpuClk (MAX.16MHz)
  44          * 1) CpuCLK=SysCLK
  45          * 2) CpuClk=SysClk/2
  46          *************************************************/
  47          #define MCU_CPUCLK    (MCU_SYSCLK)
  48          //#define MCU_CPUCLK    (MCU_SYSCLK/2)
  49          
  50          #define TIMER_1T_1ms_TH ((65536-(u16)(float)(1000*((float)(MCU_SYSCLK)/(float)(1000000)))) /256)      
  51          #define TIMER_1T_1ms_TL ((65536-(u16)(float)(1000*((float)(MCU_SYSCLK)/(float)(1000000)))) %256)
  52          
  53          #define TIMER_12T_1ms_TH  ((65536-(u16)(float)(1000*((float)(MCU_SYSCLK)/(float)(12000000)))) /256)       
C51 COMPILER V9.60.7.0   CODE                                                              01/25/2024 16:45:53 PAGE 2   

  54          #define TIMER_12T_1ms_TL  ((65536-(u16)(float)(1000*((float)(MCU_SYSCLK)/(float)(12000000)))) %256)
  55          
  56          #define LED_R   P32
  57          #define LED_G_0   P33
  58          #define LED_G_1   P46
  59          
  60          
  61          /*************************************************
  62          *Function:     void DelayXus(u8 xUs)
  63          *Description:  delay,unit:us
  64          *Input:     u8 Us -> *1us  (1~255)
  65          *Output:     
  66          *************************************************/
  67          void DelayXus(u8 xUs)
  68          {
  69   1        while(xUs!=0)
  70   1        {
  71   2      #if (MCU_CPUCLK>=11059200)
                  _nop_();
              #endif
  74   2      #if (MCU_CPUCLK>=14745600)
                  _nop_();
                  _nop_();
                  _nop_();
                  _nop_();
              #endif
  80   2      #if (MCU_CPUCLK>=16000000)
                  _nop_();
              #endif
  83   2      
  84   2      #if (MCU_CPUCLK>=22118400)
                  _nop_();
                  _nop_();
                  _nop_();
                  _nop_();
                  _nop_();
                  _nop_();
              #endif
  92   2      #if (MCU_CPUCLK>=24000000)
                  _nop_();
                  _nop_();
              #endif    
  96   2      #if (MCU_CPUCLK>=29491200)
                  _nop_();
                  _nop_();
                  _nop_();
                  _nop_();
                  _nop_();
                  _nop_();
              #endif
 104   2      #if (MCU_CPUCLK>=32000000)
                  _nop_();
                  _nop_();
              #endif
 108   2      
 109   2          xUs--;
 110   2        }
 111   1      }
 112          
 113          /*************************************************
 114          *Function:     void DelayXms(u16 xMs)
 115          *Description:delay,unit:ms
C51 COMPILER V9.60.7.0   CODE                                                              01/25/2024 16:45:53 PAGE 3   

 116          *Input:     u16 xMs -> *1ms  (1~65535)
 117          *Output:     
 118          *************************************************/
 119          void DelayXms(u16 xMs)
 120          {
 121   1        while(xMs!=0)
 122   1        {
 123   2          CLRWDT();
 124   2          DelayXus(200);
 125   2          DelayXus(200);
 126   2          DelayXus(200);
 127   2          DelayXus(200);
 128   2          DelayXus(200);
 129   2          xMs--;
 130   2          
 131   2        }
 132   1      }
 133          
 134          /***********************************************************************************
 135          *Function:   void EnP44P45GPIO(void)
 136          *Description:   set P44/P45 to GPIO, Disable OCD function
 137          *   Note: after this setting,P44/P45 will not be available for OCD-ICE, 
 138          *Input:   
 139          *Output:     
 140          *************************************************************************************/
 141          void EnP44P45GPIO(void)
 142          {
 143   1        u8 x;
 144   1        bit bEA=EA;
 145   1        ISPCR=0x80;
 146   1        IFADRH=0x00;
 147   1        IFADRL=DCON0_P;
 148   1        IFMT=ISP_READ_P;
 149   1        SCMD=0x46;
 150   1        SCMD=0xB9;
 151   1        _nop_();
 152   1        x=IFD;
 153   1        x=x&(~OCDE_P);
 154   1        IFD=x;
 155   1        IFMT=ISP_WRITE_P;
 156   1        SCMD=0x46;
 157   1        SCMD=0xB9;
 158   1        _nop_();
 159   1        ISPCR=0x00;
 160   1        IFMT=ISP_STANBY;
 161   1        
 162   1      }
 163          
 164          /***********************************************************************************
 165          *Function:   void EnP47GPIO(void)
 166          *Description:   set P47 to GPIO, Disable RESET function
 167          *Input:   
 168          *Output:     
 169          *************************************************************************************/
 170          void EnP47GPIO(void)
 171          {
 172   1        u8 x;
 173   1        bit bEA=EA;
 174   1        ISPCR=0x80;
 175   1        IFADRH=0x00;
 176   1        IFADRL=DCON0_P;
 177   1        IFMT=ISP_READ_P;
C51 COMPILER V9.60.7.0   CODE                                                              01/25/2024 16:45:53 PAGE 4   

 178   1        SCMD=0x46;
 179   1        SCMD=0xB9;
 180   1        _nop_();
 181   1        x=IFD;
 182   1        x=x&(~RSTIO_P);
 183   1        IFD=x;
 184   1        IFMT=ISP_WRITE_P;
 185   1        SCMD=0x46;
 186   1        SCMD=0xB9;
 187   1        _nop_();
 188   1        ISPCR=0x00;
 189   1        IFMT=ISP_STANBY;
 190   1        
 191   1      }
 192          
 193          
 194          /***********************************************************************************
 195          *Function:   void InitPort(void)
 196          *Description:   Initialize IO Port
 197          *Input:   
 198          *Output:     
 199          *************************************************************************************/
 200          void InitPort(void)
 201          {
 202   1      //  PORT_SetP3QuasiBi(BIT0|BIT1|BIT2|BIT3);   // Set P30,P31,P32,P33 as Quasi-Bidirectional,for RXD/TXD,LED
 203   1      //  PORT_SetP4OpenDrainPu(BIT6);        // Set P46 as Open-Drain with pull-up resistor,for LED
 204   1      
 205   1      //  PORT_SetP4OpenDrainPu(BIT4|BIT5|BIT7);    // Set P44,P45,P47 as Open-Drain with pull-up resistor
 206   1        
 207   1        
 208   1        
 209   1        
 210   1        PORT_SetP3QuasiBi(BIT0|BIT1);
 211   1        PORT_SetP3PushPull(BIT3);
 212   1        PORT_SetP4PushPull(BIT4|BIT5|BIT6);
 213   1        
 214   1      }
 215          
 216          /***********************************************************************************
 217          *Function:   void InitSystem(void)
 218          *Description:   Initialize MCU
 219          *Input:   
 220          *Output:     
 221          *************************************************************************************/
 222          void InitSystem(void)
 223          {
 224   1        InitPort();
 225   1      
 226   1      }
 227          
 228          void main()
 229          {
 230   1          InitSystem();
 231   1      //  
 232   1        LED_G_0=0;LED_G_1=0;LED_R=0;
 233   1        DelayXms(2000);
 234   1        LED_G_0=1;LED_G_1=1;LED_R=1;
 235   1      
 236   1        // Delay 2s before set P44,P45,P47 as GPIO
 237   1        // the SWD and reset pin are still valid for two seconds after power-on, 
 238   1        // and the OCD-ICE program can be updated during this time
 239   1        DelayXms(2000);
C51 COMPILER V9.60.7.0   CODE                                                              01/25/2024 16:45:53 PAGE 5   

 240   1        EnP44P45GPIO();
 241   1      //  EnP47GPIO();
 242   1          P44=0;P33=0;P46=0;  P45=0;
 243   1          while(1)
 244   1          {
 245   2      //       if(P44==1)
 246   2      //       {
 247   2      //      P33=1;
 248   2      //      DelayXms(2000);
 249   2      //      P33=0;
 250   2      //      P46=1;
 251   2      //      DelayXms(2000);
 252   2      //      P46=0;
 253   2      //      P45=1;
 254   2      //      DelayXms(2000);
 255   2      //      P45=0;
 256   2      //       }
 257   2      
 258   2      P45=1;P44=1;DelayXms(2000);P45=0;P44=0;DelayXms(2000);
 259   2      //P11=0;  // TO CHECK   
 260   2              P33=0; // .............. made changes now  3/1
 261   2            //Newly updated 
 262   2            
 263   2          }
 264   1      }
 265          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    224    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
